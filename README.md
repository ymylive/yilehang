# éŸ§ç¿æˆé•¿è®¡åˆ’

ä¸€ä¸ªä»¥å¾®ä¿¡å°ç¨‹åºä¸ºæ ¸å¿ƒè½½ä½“çš„é’å°‘å¹´ä½“è‚²åŸ¹è®­æ•°å­—åŒ–å¹³å°ï¼Œè¦†ç›–å­¦å‘˜ç«¯ã€æ•™ç»ƒç«¯ã€ç®¡ç†åå°ä¸åç«¯æœåŠ¡ã€‚

## é¡¹ç›®å®šä½

å›´ç»•â€œçº¦è¯¾-ä¸Šè¯¾-è¯¾æ—¶æ¶ˆè€—-å¤è´­è¿è¥â€ä¸»é“¾è·¯ï¼Œæä¾›ä¸‰ç±»è§’è‰²äº§å“ï¼š

- å­¦å‘˜ç«¯ï¼ˆ`apps/client`ï¼‰ï¼šçº¦è¯¾ã€è¯¾è¡¨ã€è¯¾æ—¶å¡ã€è®­ç»ƒè®°å½•ã€æ¶ˆæ¯é€šçŸ¥
- æ•™ç»ƒç«¯ï¼ˆ`apps/coach`ï¼‰ï¼šå·¥ä½œå°ã€æ’è¯¾ã€å­¦å‘˜ç®¡ç†ã€åé¦ˆã€æ”¶å…¥ã€è¯„ä»·
- å•†å®¶ç«¯ï¼ˆ`apps/merchant`ï¼‰ï¼šå…‘æ¢è®¢å•å¤„ç†ã€æ ¸é”€ã€ç»è¥ç»Ÿè®¡
- ç»Ÿä¸€å¤šè§’è‰²ç«¯ï¼ˆ`apps/unified-miniapp`ï¼‰ï¼šæŒ‰è§’è‰²åŠ¨æ€å‘ˆç°é¡µé¢ä¸æƒé™
- ç®¡ç†åå°ï¼ˆ`apps/admin`ï¼‰ï¼šç»è¥æ•°æ®ã€ç”¨æˆ·ç®¡ç†ã€è¿è¥çœ‹æ¿

åç«¯æœåŠ¡ä½äº `apps/api`ï¼Œä½¿ç”¨ FastAPI + PostgreSQL æä¾›ç»Ÿä¸€ APIã€‚

## å½“å‰çŠ¶æ€ï¼ˆ2026-02ï¼‰

å·²ä¸Šçº¿/å·²å¯ç”¨èƒ½åŠ›ï¼š

- å­¦å‘˜ç«¯ï¼šé¢„çº¦æµç¨‹ã€è¯¾è¡¨ã€è®­ç»ƒæ¨¡å—ã€ä¼šå‘˜å¡ä¸æ¶ˆè´¹è®°å½•ã€åŸºç¡€è¯„ä»·æµç¨‹
- æ•™ç»ƒç«¯ï¼šå·¥ä½œå°ã€è¯¾è¡¨ä¸è¯¦æƒ…ã€å­¦å‘˜åˆ—è¡¨ä¸è¯¦æƒ…ã€å­¦ä¹ åé¦ˆã€æ”¶å…¥æ˜ç»†ã€è¯„ä»·å›å¤ã€ä¸ªäººä¸­å¿ƒ
- å•†å®¶ç«¯ï¼šå…‘æ¢è®¢å•åˆ—è¡¨ã€æ‰«ç æ ¸é”€ã€å•†å®¶æ•°æ®çœ‹æ¿
- ç»Ÿä¸€å°ç¨‹åºï¼šå®¶é•¿/å­¦å‘˜/æ•™ç»ƒ/ç®¡ç†å‘˜å¤šè§’è‰²è·¯ç”±ä¸é¡µé¢æƒé™æ§åˆ¶
- åç«¯ï¼šè®¤è¯ã€æ•™ç»ƒã€å­¦å‘˜ã€é¢„çº¦ã€ä¼šå‘˜å¡ã€è¯„ä»·ã€æ•°æ®çœ‹æ¿ã€AI å ä½æ¥å£
- éƒ¨ç½²ï¼šDocker åŒ–ï¼ˆAPI + PostgreSQL + Nginxï¼‰å¹¶å·²å¯ç”¨ HTTPS

æœ€è¿‘å·²å®Œæˆçš„é‡æ„ï¼š

- æ•™ç»ƒç«¯ä¸»è¦é¡µé¢ç”± Mock æ•°æ®åˆ‡æ¢ä¸ºçœŸå® API
- å­¦å‘˜ç«¯ä¸æ•™ç»ƒç«¯ç»Ÿä¸€æ©™é»„ä¸»è§†è§‰ä¸äº¤äº’åŠ¨æ•ˆ
- å…³é”®æ–‡æ¡ˆä¸å±•ç¤ºé€»è¾‘ç»Ÿä¸€ï¼Œé™ä½ç¼–ç å¯¼è‡´çš„ä¹±ç é£é™©
- æ–°å¢æ¶ˆæ¯ã€é€šçŸ¥ã€ä¸Šä¼ ã€èƒ½é‡ä½“ç³»ã€å•†å®¶å…‘æ¢ä¸æ’è¡Œæ¦œç›¸å…³ API/é¡µé¢
- æ¥å…¥ RBAC è§’è‰²æƒé™æ¨¡å‹ï¼Œæ”¯æŒæŒ‰è§’è‰²åˆ†å‘èœå•ä¸é¡µé¢èƒ½åŠ›

**æœ€æ–°ä¿®å¤ï¼ˆ2026-02-10ï¼‰**ï¼š
- ğŸ”’ å®‰å…¨åŠ å›ºï¼šç§»é™¤æ‰€æœ‰ç¡¬ç¼–ç å¯†ç ï¼Œå¼ºåŒ– JWT é…ç½®ï¼Œæ·»åŠ å¯†ç å¤æ‚åº¦éªŒè¯å’Œé€Ÿç‡é™åˆ¶
- âš¡ æ€§èƒ½ä¼˜åŒ–ï¼šä¿®å¤ 3 ä¸ª N+1 æŸ¥è¯¢é—®é¢˜ï¼ŒæŸ¥è¯¢æ•°é‡å‡å°‘ 85-97%ï¼Œé¡µé¢åŠ è½½é€Ÿåº¦æå‡ 5-10 å€
- ğŸ”— åŠŸèƒ½å®Œå–„ï¼šæ·»åŠ  3 ä¸ªç¼ºå¤±çš„æ•™ç»ƒç«¯ç‚¹ï¼Œä¿®å¤æ•™ç»ƒåŠŸèƒ½æŸå
- ğŸ¨ ä»£ç è´¨é‡ï¼šé‡æ„é‡å¤ä»£ç ï¼Œæå–ä¸šåŠ¡è§„åˆ™åˆ°é…ç½®æ–‡ä»¶
- è¯¦è§ [ä¿®å¤æŠ¥å‘Š](reports/fix_summary.md) å’Œ [ä»£ç å®¡æŸ¥æŠ¥å‘Š](reports/code_review_report.md)

**æœ€æ–°æ›´æ–°ï¼ˆ2026-02-13ï¼‰**ï¼š
- ğŸ›¡ï¸ æƒé™ä¸ä¼šè¯å®‰å…¨ï¼šè¡¥é½å¯¹è±¡çº§è®¿é—®æ§åˆ¶ä¸ WebSocket ç¥¨æ®é‰´æƒï¼Œæ–°å¢å¯¹åº”å®‰å…¨æµ‹è¯•ç”¨ä¾‹
- ğŸ“± ç»Ÿä¸€å°ç¨‹åºç¨³å®šæ€§ï¼šæ–°å¢é¡µé¢é”™è¯¯è¾¹ç•Œã€å®‰å…¨å¯¼èˆªå°è£…å’Œæœ¬åœ°é¥æµ‹äº‹ä»¶è®°å½•
- ğŸ–¼ï¸ é™æ€èµ„æºæ²»ç†ï¼šè¡¥é½é»˜è®¤å¤´åƒ/ç©ºæ€èµ„æºå¹¶åœ¨æ„å»ºå‰æ‰§è¡Œé™æ€èµ„æºå¼•ç”¨æ ¡éªŒ
- ğŸŒ ç”Ÿäº§åŸŸåç»Ÿä¸€ï¼šæ–‡æ¡£ä¸éƒ¨ç½²æ¨¡æ¿å…¨éƒ¨å¯¹é½åˆ° `rl.cornna.xyz`

## ä»“åº“ç»“æ„

```text
yilehang/
|- apps/
|  |- client/          # å­¦å‘˜ç«¯å°ç¨‹åºï¼ˆUniAppï¼‰
|  |- coach/           # æ•™ç»ƒç«¯å°ç¨‹åºï¼ˆUniAppï¼‰
|  |- merchant/        # å•†å®¶ç«¯å°ç¨‹åºï¼ˆUniAppï¼‰
|  |- unified-miniapp/ # ç»Ÿä¸€å¤šè§’è‰²å°ç¨‹åºï¼ˆUniAppï¼‰
|  |- admin/           # ç®¡ç†åå°ï¼ˆVue3 + Viteï¼‰
|  |- web/             # å®˜ç½‘é™æ€èµ„æº
|  \- api/             # åç«¯æœåŠ¡ï¼ˆFastAPIï¼‰
|- website/            # å®˜ç½‘æ„å»ºäº§ç‰©/éƒ¨ç½²ç›®å½•
|- packages/
|  |- ui/
|  |- utils/
|  \- types/
|- database/
|- docker/
|- scripts/
|- docs/
\- README.md
```

## æŠ€æœ¯æ ˆ

- å­¦å‘˜ç«¯/æ•™ç»ƒç«¯ï¼šUniApp + Vue3 + TypeScript + Pinia + Wot Design Uni
- å•†å®¶ç«¯/ç»Ÿä¸€å°ç¨‹åºï¼šUniApp + Vue3 + TypeScript + Pinia
- ç®¡ç†åå°ï¼šVue3 + TypeScript + Element Plus + ECharts
- åç«¯ï¼šFastAPI + SQLAlchemy + PostgreSQL
- éƒ¨ç½²ï¼šDocker Compose + Nginx + acme.shï¼ˆCloudflare DNS éªŒè¯ï¼‰

## å¿«é€Ÿå¼€å§‹

### 1ï¼‰ç¯å¢ƒè¦æ±‚

- Node.js >= 18
- pnpm >= 8
- Python >= 3.10
- PostgreSQL >= 15

### 2ï¼‰å®‰è£…ä¾èµ–

```bash
pnpm install

cd apps/api
pip install -e .
cp .env.example .env
```

### 3ï¼‰æœ¬åœ°å¼€å‘å¯åŠ¨

åœ¨ä»“åº“æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
pnpm dev:api      # FastAPIï¼Œé»˜è®¤ :8000
pnpm dev:client   # å­¦å‘˜ç«¯ H5 è°ƒè¯•
pnpm dev:coach    # æ•™ç»ƒç«¯ H5 è°ƒè¯•
pnpm dev:merchant # å•†å®¶ç«¯ H5 è°ƒè¯•
pnpm dev:admin    # ç®¡ç†åå°
```

### 4ï¼‰æ„å»ºå¾®ä¿¡å°ç¨‹åºåŒ…

```bash
pnpm -C apps/client build:mp-weixin
pnpm -C apps/coach build:mp-weixin
pnpm -C apps/merchant build:h5
```

å¾®ä¿¡å¼€å‘è€…å·¥å…·å¯¼å…¥ç›®å½•ï¼š

- `apps/client/dist/build/mp-weixin`
- `apps/coach/dist/build/mp-weixin`

## API å…¥å£

åç«¯å¯åŠ¨åå¯è®¿é—®ï¼š

- Swaggerï¼š`http://localhost:8000/docs`
- ReDocï¼š`http://localhost:8000/redoc`
- Healthï¼š`http://localhost:8000/health`

ä¸»è¦æ¨¡å—ï¼ˆç»Ÿä¸€å‰ç¼€ `/api/v1`ï¼‰ï¼š

- `/auth`
- `/students`
- `/schedules`
- `/training`
- `/growth`
- `/bookings`
- `/memberships`
- `/coaches`
- `/reviews`
- `/dashboard`
- `/ai`
- `/user`ï¼ˆè§’è‰²ç›¸å…³ï¼‰
- `/notifications`
- `/upload`
- `/chat`
- `/energy`
- `/merchants`
- `/leaderboard`

è§’è‰²-é¡µé¢æ˜ å°„ä¸æƒé™è¯´æ˜è§ï¼š`docs/role_pages_mapping.md`

## ç™»å½•ä¸æ³¨å†Œè¯´æ˜ï¼ˆå°ç¨‹åºï¼‰

- å¾®ä¿¡ç™»å½•ï¼šå¿…é¡»åœ¨å¾®ä¿¡å°ç¨‹åºå†…å®Œæˆæˆæƒï¼Œåç«¯ä¼šæ ¡éªŒå¾®ä¿¡ç™»å½•å‡­è¯å¹¶åŒæ­¥å¾®ä¿¡æ˜µç§°/å¤´åƒã€‚
- è´¦å·ç™»å½•ï¼šæ”¯æŒ `ç”¨æˆ·å / æ‰‹æœºå· / é‚®ç®± + å¯†ç `ã€‚
- é‚®ç®±æ³¨å†Œï¼šæ”¯æŒé‚®ç®±éªŒè¯ç æ³¨å†Œï¼Œå¹¶å¯è®¾ç½®ç”¨æˆ·åã€æ‰‹æœºå·ä½œä¸ºåç»­ç™»å½•å‡­è¯ã€‚

åç«¯ç¯å¢ƒå˜é‡ï¼ˆ`apps/api/.env`ï¼‰è‡³å°‘éœ€è¦é…ç½®ï¼š

- `WECHAT_APPID`
- `WECHAT_SECRET`
- `SMTP_HOST`
- `SMTP_PORT`
- `SMTP_USER`
- `SMTP_PASSWORD`
- `SMTP_FROM`
- `ALLOW_WECHAT_LOGIN_WITHOUT_SECRET=false`

## çº¿ä¸Šéƒ¨ç½²å¿«ç…§

è¯¦è§ï¼š`DEPLOYMENT_REPORT.md`

- çº¿ä¸ŠåŸŸåï¼š`https://rl.cornna.xyz`
- API æ–‡æ¡£ï¼š`https://rl.cornna.xyz/docs`

## åç»­å¼€å‘è®¡åˆ’ï¼ˆ1 å‘¨å†²åˆºï¼‰

è¯¦ç»†è®¡åˆ’è§ï¼š`docs/dev_plan.md`

æœ¬å‘¨ç›®æ ‡ï¼šåœ¨ 7 å¤©å†…äº¤ä»˜â€œå­¦å‘˜çº¦è¯¾ + æ•™ç»ƒå®Œè¯¾ + è¯¾æ—¶æ‰£å‡ + çº¿ä¸Šå¯éƒ¨ç½²â€çš„å¯ç”¨é—­ç¯ã€‚

æœ¬å‘¨å¿…åšï¼ˆP0ï¼‰ï¼š

- å­¦å‘˜ç«¯ï¼šç™»å½•ã€çº¦è¯¾ã€è¯¾è¡¨ã€è¯¾æ—¶/æ¶ˆè´¹è®°å½•
- æ•™ç»ƒç«¯ï¼šè¯¾è¡¨ã€å®Œè¯¾ã€å­¦ä¹ åé¦ˆã€å­¦å‘˜æŸ¥çœ‹
- åç«¯ï¼šé¢„çº¦å†²çªæ ¡éªŒã€æ‰£è¯¾ä¸€è‡´æ€§ã€è§’è‰²æƒé™æœ€å°å¯ç”¨
- è¿ç»´ï¼šDocker å‘å¸ƒã€HTTPSã€å›æ»šæ–¹æ¡ˆ

å»¶æœŸåˆ°ä¸‹å‘¨ï¼ˆéæœ¬å‘¨èŒƒå›´ï¼‰ï¼š

- AI è·³ç»³è¯†åˆ«ä¸é¥®é£Ÿå»ºè®®
- ç²¾ç»†åŒ–è¿è¥çœ‹æ¿ä¸æµå¤±é¢„è­¦
- å¤æ‚è¥é”€æ´»åŠ¨ï¼ˆè€å¸¦æ–°ã€ç»„åˆä¿ƒé”€ï¼‰

è¯¦ç»†æ—¥è®¡åˆ’ä¸éªŒæ”¶æ ‡å‡†è§ï¼š`docs/dev_plan.md`

## è´¨é‡ä¸å®‰å…¨åŸºçº¿

- è®¤è¯ï¼šæ‰‹æœºå·éªŒè¯ç ç™»å½• + token ç”Ÿå‘½å‘¨æœŸç®¡ç†
- æ•°æ®å®‰å…¨ï¼šè§’è‰²éš”ç¦»ã€éšç§åè®®ã€æˆæƒæµç¨‹
- å¯è¿ç»´æ€§ï¼šç°åº¦/å›æ»šç­–ç•¥ã€ç»“æ„åŒ–æ—¥å¿—ã€å‘Šè­¦é˜ˆå€¼

## å¼€å‘åä½œè§„èŒƒ

æ¨èæäº¤è§„èŒƒï¼š

```text
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤é—®é¢˜
refactor: é‡æ„ï¼ˆä¸æ”¹è¡Œä¸ºï¼‰
docs: æ–‡æ¡£æ›´æ–°
test: æµ‹è¯•ç›¸å…³
chore: å·¥å…·é“¾/æ„å»ºç»´æŠ¤
```

### åŸŸåè§„èŒƒï¼ˆå¼ºåˆ¶ï¼‰

- ä¸»åŸŸåï¼š`https://rl.cornna.xyz`
- API åŸºåœ°å€ï¼š`https://rl.cornna.xyz/api/v1`
- WebSocketï¼š`wss://rl.cornna.xyz/api/v1/chat/ws`
- ä¸Šä¼ åœ°å€ï¼š`https://rl.cornna.xyz/api/v1/upload`
- ç”Ÿäº§ç¯å¢ƒç¦æ­¢ä½¿ç”¨ IP æˆ–å…¶ä»–åŸŸåä½œä¸ºè¯·æ±‚å…¥å£ï¼›å¦‚éœ€å˜æ›´åŸŸåï¼Œå¿…é¡»åŒæ­¥æ›´æ–°å‰ç«¯ç¯å¢ƒå˜é‡ã€åç«¯åä»£ä¸éƒ¨ç½²æ–‡æ¡£ã€‚

---

å¦‚éœ€äº‘ç«¯ä¸€é”®éƒ¨ç½²ï¼Œè¯·å‚è€ƒï¼š

- `scripts/deploy_full.py`
- `scripts/setup_ssl.py`

å¹¶ç»“åˆ `DEPLOYMENT_REPORT.md` å¯¹ç…§çº¿ä¸Šé…ç½®æ‰§è¡Œã€‚

## Deployment Update (2026-02-09)

- Re-deployed services after VPS reboot on `82.158.88.34`.
- Production domain/API kept on `https://rl.cornna.xyz`.
- SSL re-issued and installed via `acme.sh` using Cloudflare DNS validation.
- Miniapp production env template updated in `deploy/miniapp/env.example`:
  - `VITE_API_BASE_URL=https://rl.cornna.xyz/api/v1`
  - `VITE_WS_URL=wss://rl.cornna.xyz/api/v1/chat/ws`
  - `VITE_UPLOAD_URL=https://rl.cornna.xyz/api/v1/upload`
